# APC AP7900 series PDU device definition for PowerMan
# Simplified version for basic APC PDUs

specification "apcpdu" {
    timeout 10.0
    
    plug name { "1" "2" "3" "4" "5" "6" "7" "8" }
    
    script login {
        expect "(User Name|Username|Login|APC>|>)"
        send "apc\r"
        expect "(Password|password)"
        send "apc\r"
        expect ">"
    }
    
    script logout {
        send "4\r"
        expect "(Y/N)"
        send "YES\r"
    }
    
    script status_all {
        send "1\r"
        expect ">"
        send "1\r"
        foreachplug {
            expect "([0-9]+)-.*(ON|OFF)"
            setplugstate $1 $2 on="ON" off="OFF"
        }
        expect ">"
        send "\033"
        expect ">"
        send "\033"
        expect ">"
    }
    
    script on_ranged {
        send "1\r"
        expect ">"
        send "2\r"
        expect ">"
        foreachplug {
            send "%s\r"
            expect "(Y/N)"
            send "Y\r"
            expect "to continue..."
            send "\r"
            expect ">"
        }
        send "\033"
        expect ">"
        send "\033"
        expect ">"
    }
    
    script off_ranged {
        send "1\r"
        expect ">"
        send "3\r"
        expect ">"
        foreachplug {
            send "%s\r"
            expect "(Y/N)"
            send "Y\r"
            expect "to continue..."
            send "\r"
            expect ">"
        }
        send "\033"
        expect ">"
        send "\033"
        expect ">"
    }
    
    script cycle_ranged {
        send "1\r"
        expect ">"
        send "4\r"
        expect ">"
        foreachplug {
            send "%s\r"
            expect "(Y/N)"
            send "Y\r"
            expect "to continue..."
            send "\r"
            expect ">"
        }
        send "\033"
        expect ">"
        send "\033"
        expect ">"
    }
}
